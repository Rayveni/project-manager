version: "3.91"
services:
  app:
    build:
      context: ./backend/ 
      dockerfile: Dockerfile      
    image: local_image/project_app       
    # flask requires SIGINT to stop gracefully
    # (default stop signal from Compose is SIGTERM)
    stop_signal: SIGINT 
    environment:
      - TZ=${timezone}
      - gapi_secret_path=${gapi_secret_path}
    # secrets block only for 'web' service
    secrets: 
      - source: gapi_secret
        target: "${gapi_secret_path}"               
    volumes: 
      - type: bind
        source: ${code_source}
        target: /app  
    command: python server.py           
    ports:
      - "${app_ports}"

# top level secrets block
secrets:
  gapi_secret:
    file: "${gapi_secret_file}"